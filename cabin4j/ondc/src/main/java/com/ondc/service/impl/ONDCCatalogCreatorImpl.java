package com.ondc.service.impl;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.persistence.EntityManager;
import javax.persistence.Query;

import org.apache.commons.collections4.CollectionUtils;
import org.json.JSONArray;
import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.ondc.service.ONDCCatalogCreator;
import com.xhopfront.entities.PSU;
import com.xhopfront.entities.SKU;

@Component("ondcCatalogCreator")
public class ONDCCatalogCreatorImpl implements ONDCCatalogCreator {

	private static final String template1 = "{\"name\":\"Xhopfront\",\"code\":\"Xhopfront\",\"symbol\":\"\",\"short_desc\":\"agri Xhopfront\",\"long_desc\":\"\",\"images\":[\"\"]}";

	private static final String template2 = "{\"id\":\"Grocery\",\"descriptor\":{\"name\":\"Grocery\",\"short_desc\":\"All kinds of Packaged Commodities\"}},{\"id\":\"F&B\",\"descriptor\":{\"name\":\"F&B\",\"short_desc\":\"All kinds of Packaged food\"}},{\"id\":\"Fashion\",\"descriptor\":{\"name\":\"Fashion\",\"short_desc\":\"All kinds of dress and accessory\"}},{\"id\":\"Packaged Commodities\",\"descriptor\":{\"name\":\"Packaged Commodities\",\"short_desc\":\"All kinds of Packaged goods\"}},{\"id\":\"Pre-packaged food\",\"descriptor\":{\"name\":\"Pre-packaged food\",\"short_desc\":\"All kinds of Pre-packaged food\"}},{\"id\":\"Fresh vegetables and fruits\",\"descriptor\":{\"name\":\"Fresh vegetables and fruits\",\"short_desc\":\"Fresh vegetables and fruits\"}}";

	private static final String template3 = "{\"id\":\"527dd76d-5c70-4a76-a667-4257fad6215f\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"1994\",\"descriptor\":{\"name\":\"SHAMROCK OVERSEAS LIMITED\"},\"gps\":\"12.930760000,77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"923bb4ad-4ed6-4936-b15a-485ad32a1957\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2000\",\"descriptor\":{\"name\":\"Crystal Crop Protection\"},\"gps\":\"12.930760000,\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"e6bb0e65-f27c-4fdd-baf3-83272c263f3d\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2003\",\"descriptor\":{\"name\":\"ABTEC\"},\"gps\":\"12.930760000,77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"f171690c-dbf9-4117-8e4d-464e846df2d6\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2009\",\"descriptor\":{\"name\":\"MeenakshiAgrofarms\"},\"gps\":\"12.930760000,77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"21d3c6f0-db50-487c-ad2f-32c850d22c6d\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2012\",\"descriptor\":{\"name\":\"Agni Solar Systems\"},\"gps\":\"12.930760000,77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"a5d6d51e-4c22-4625-bc63-17bb6193e89f\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2015\",\"descriptor\":{\"name\":\"TATA Agrico\"},\"gps\":\"12.930760000,\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"ee922241-0841-4180-a786-b8b2703f7d23\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2018\",\"descriptor\":{\"name\":\"Ratnagiri Impex\"},\"gps\":\"12.930760000,\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"dd26c32d-b7f9-401e-a854-492a3120a127\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2027\",\"descriptor\":{\"name\":\"Kohinoor\"},\"gps\":\"12.930760000,77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"103ce6b8-6ffa-4915-913a-e47bed2d5f7c\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2030\",\"descriptor\":{\"name\":\"NAVA BHARAT LIMITED\"},\"gps\":\",77.619169000\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"a2213672-0a66-4b3c-8205-622d85e48779\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2033\",\"descriptor\":{\"name\":\"SrigandhaNursery\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"9cbcd7b8-dbea-4e70-8da7-7b283d11b2bf\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2036\",\"descriptor\":{\"name\":\"AlphaAce Technology\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"a2b3def5-39fb-4df8-b7ac-488b8c7aa0c7\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2039\",\"descriptor\":{\"name\":\"Farmigo Agro Tech\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"1c1c1f0c-4d8c-4458-82f2-549654101301\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2042\",\"descriptor\":{\"name\":\"Noriture\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"eaba9b2a-af73-4489-8945-eb12c14a2a8b\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2045\",\"descriptor\":{\"name\":\"Makysh\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"1e1b06a9-7e10-43d7-95dc-e617749840f2\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2048\",\"descriptor\":{\"name\":\"Dubey Krishi Suraksha Kendra\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"7efe8f45-0b34-4177-a6cb-81bec13fbc02\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2051\",\"descriptor\":{\"name\":\"Kisan X\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"5c93a9fe-29d5-405f-8d9e-6cb82dd7c17a\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2054\",\"descriptor\":{\"name\":\"Autostudio\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"35634f7c-7078-4147-9346-35453ab35643\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2057\",\"descriptor\":{\"name\":\"Balwaan\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"db46d39a-01f0-471b-9273-a0c265ec89d1\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2060\",\"descriptor\":{\"name\":\"Bioseed\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"5ae7ef21-33c8-4da8-bfbd-6257cce868c5\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2063\",\"descriptor\":{\"name\":\"Center of Excellence For Citrus\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"a0ed17f0-131f-4159-8bac-2c1c2e2a7639\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2066\",\"descriptor\":{\"name\":\"AMUL\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"7596cdc8-9f75-4606-bc31-2b4209373bd3\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2069\",\"descriptor\":{\"name\":\"Turning Point Natural care\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"566eaedf-4bd7-4266-a20a-3fc7e7315972\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2072\",\"descriptor\":{\"name\":\"PI Industries\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"e21ee86a-aea9-4ca9-b6e8-b543227f7683\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2075\",\"descriptor\":{\"name\":\"Deejay Farms\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"9b280193-ae0f-4ac0-8439-c9d1d2a85de7\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2078\",\"descriptor\":{\"name\":\"Evergreen Fabtech\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"1ac6f4b3-ca4b-4b8d-906f-c06908224845\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2081\",\"descriptor\":{\"name\":\"Ecowealth Agrobiotech\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"64fa6f92-3f73-40ad-aa8f-4d366a49b6d0\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2084\",\"descriptor\":{\"name\":\"Sea6 Energy\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"92314141-3fb3-4990-ad13-288f93dfec65\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2087\",\"descriptor\":{\"name\":\"PIAL\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"73e2f607-29e2-4e90-aae8-608462648574\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2090\",\"descriptor\":{\"name\":\"FarmoGuard\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"abda263c-7000-42ac-9f16-1fe55ddfb3b8\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2093\",\"descriptor\":{\"name\":\"Geolife\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"dc6cf7b4-1750-4c7a-9c71-40da9e57a31a\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2096\",\"descriptor\":{\"name\":\"Gold Modil Machinary\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"fa442edf-53ec-4011-96bb-dac867793bb6\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2099\",\"descriptor\":{\"name\":\"Best Agri\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"b981cce2-c927-452e-8a43-861d178a0e90\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2102\",\"descriptor\":{\"name\":\"Soujanya Nursery\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"737f8bb4-5f43-4ed1-9675-e8f63cd7fabf\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2105\",\"descriptor\":{\"name\":\"Growit India\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"439adef3-6e1e-4121-a1b8-7a8d84cd030b\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2108\",\"descriptor\":{\"name\":\"Kamal Kisan\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"83489fe6-f6e4-4c13-898d-9e968e0f11bd\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2111\",\"descriptor\":{\"name\":\"Katyayani Organics\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"89404f05-63ab-49f5-b246-ec5b9f6aeabc\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2114\",\"descriptor\":{\"name\":\"Ankur\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"e700c727-ef48-4169-9483-24d23b26ba06\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2117\",\"descriptor\":{\"name\":\"UPL\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"ba091335-9f59-4306-b218-f1372bc4fcb9\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2120\",\"descriptor\":{\"name\":\"Fito\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"f2b8d4f9-1fde-46d8-8761-5f6bd723905b\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2123\",\"descriptor\":{\"name\":\"Namdhari\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"99c3e035-f54c-4d8e-b13a-7dd0aa2170eb\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2126\",\"descriptor\":{\"name\":\"Kaveri\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"8f2c6402-d44a-470a-9e64-b9bdfb7e5348\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2129\",\"descriptor\":{\"name\":\"Indo US\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"3da85904-2cea-4119-b36f-f4bb47b0e6ab\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2132\",\"descriptor\":{\"name\":\"Known-You\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"f93be2f8-ed5c-4339-951a-b98d0d0c28e4\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2135\",\"descriptor\":{\"name\":\"Pahuja\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"cbd3eca9-f9a6-45e4-a443-cd8b16e62237\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2138\",\"descriptor\":{\"name\":\"Indo-American\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"9db00f35-d21c-49fd-88bd-aa6d9eadf983\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2141\",\"descriptor\":{\"name\":\"VNR\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"b81f38ad-83a7-4bb6-84f7-86d3e859eb40\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2144\",\"descriptor\":{\"name\":\"Rijk Zwaan\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"da1b0ca6-bfe0-4df9-8308-15e6ba2ec602\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2147\",\"descriptor\":{\"name\":\"Multiplex Urban Green\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"a4c60e91-b23d-49d5-ab78-507063bcb5cc\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2150\",\"descriptor\":{\"name\":\"Utkal\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"86c1f5e8-2507-4d8f-a04f-17856817b3d6\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2153\",\"descriptor\":{\"name\":\"Megatex\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"6cc624b3-2c39-4d49-b596-e88bff1e8658\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2156\",\"descriptor\":{\"name\":\"Mipatex\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"256b43d5-4503-468b-a1c3-b7b8bd599222\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2159\",\"descriptor\":{\"name\":\"NG Enterprise\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"4e1e627d-468d-496d-af43-671bf9c864b5\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2162\",\"descriptor\":{\"name\":\"Kay bee\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"f3d3e7bd-f250-4648-842a-b3148a472ff4\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2165\",\"descriptor\":{\"name\":\"Adama\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"df9823a8-6ae1-4fc4-9e3e-d13a15f196a7\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2168\",\"descriptor\":{\"name\":\"PAD Corp\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"d6aa323b-85e9-4e76-9efd-0c9056e27dac\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2171\",\"descriptor\":{\"name\":\"Greenlight Planet\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"ffbfa040-53e1-494a-ac2c-05acfe4f9ac7\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2174\",\"descriptor\":{\"name\":\"Bioprime\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"f6ed46c5-aec1-4d8b-b443-89a3ab815363\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2177\",\"descriptor\":{\"name\":\"Triveni Solar\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"928e7a42-c9a6-4fba-a756-fb36a9cf7ba3\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2180\",\"descriptor\":{\"name\":\"UTKARSH AGRO\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"044ecb01-710d-4433-ad4b-295e62da06b7\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2183\",\"descriptor\":{\"name\":\"Vinspire Agrotech\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"26468bb8-31c7-421a-8041-2b678a522ec3\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2186\",\"descriptor\":{\"name\":\"International Panaacea\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"dc4d2702-80a9-44da-9add-19a4c0dd5417\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2189\",\"descriptor\":{\"name\":\"Plantbiotix\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"2acba990-59ae-488a-98a1-b2991e1188a0\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2192\",\"descriptor\":{\"name\":\"CLAUSE\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"bfc0b67c-7fea-45c7-891f-1e6af1f3ed4e\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2195\",\"descriptor\":{\"name\":\"United Alacrity India Pvt Ltd.\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}},{\"id\":\"09ab0a69-4d4b-4373-82be-d7e23ea6369d\",\"type\":\"Delivery\",\"tracking\":false,\"start\":{\"location\":{\"id\":\"2198\",\"descriptor\":{\"name\":\"Pioneer Agro\"},\"gps\":\",\"},\"contact\":{\"phone\":\"8056588580\",\"email\":\"dbs@digiit.biz\"}}}";

	private static final String query = "SELECT * FROM ondc.psu WHERE product.code = %s";

	private static final String template4 = "{\"fulfillment_id\":\"601713ba-d6e4-440b-867a-dbc5a5d3b8f4\",\"rating\":5,\"location_id\":\"9b33f79e-ab47-4689-a2f9-70cdea28d8cb\",\"rateable\":true,\"matched\":true,\"related\":true,\"recommended\":true,\"@ondc\\/org\\/returnable\":false,\"@ondc\\/org\\/seller_pickup_return\":false,\"@ondc\\/org\\/return_window\":\"PT24H\",\"@ondc\\/org\\/cancellable\":false,\"@ondc\\/org\\/time_to_ship\":\"PT5H\",\"@ondc\\/org\\/available_on_cod\":true,\"@ondc\\/org\\/contact_details_consumer_care\":\"9020119989\",\"@ondc\\/org\\/statutory_reqs_packaged_commodities\":{\"manufacturer_or_packer_name\":null,\"manufacturer_or_packer_address\":null,\"common_or_generic_name_of_commodity\":null,\"multiple_products_name_number_or_qty\":null,\"net_quantity_or_measure_of_commodity_in_pkg\":null,\"month_year_of_manufacture_packing_import\":null,\"imported_product_country_of_origin\":null,\"contact_details_consumer_care\":null},\"@ondc\\/org\\/statutory_reqs_prepackaged_food\":null,\"@ondc\\/org\\/mandatory_reqs_veggies_fruits\":null}";

	private static final String template5 = "{\"name\":\"Xhopfront OVERSEAS LIMITED\",\"code\":\"138_ACCT000004\",\"symbol\":\"https:\\/\\/130digiistorage229.blob.core.windows.net\\/cms\\/edoc\\/store.jpg\",\"short_desc\":\"SHAMROCK OVERSEAS LIMITED\",\"long_desc\":\"SHAMROCK OVERSEAS LIMITED\",\"images\":[\"https:\\/\\/130digiistorage229.blob.core.windows.net\\/cms\\/edoc\\/store.jpg\"]}";

	@Autowired
	private EntityManager em;

	@Override
	public JSONObject createCatalog(List<SKU> skus) {
		JSONObject obj = new JSONObject();
		obj.put("bpp/descriptor", new JSONObject(template1));
		obj.append("bpp/categories", new JSONObject(template2));
		obj.append("bpp/fulfillments", new JSONObject(template3));
		Map<String, List<JSONObject>> map = new HashMap<>();
		skus.forEach(s -> {
			Query q = em.createQuery("SELECT psu FROM PSU AS psu WHERE psu.product.code = :c");
			q.setParameter("c", s.getCode());
			q.setMaxResults(20);
			List<PSU> psus = q.getResultList();

			JSONObject o = new JSONObject(new JSONObject(template4));
			o.put("id", s.getCode());
			if (null != s.getParent())
				o.put("parent_item_id", s.getParent().getCode());
			else
				o.put("parent_item_id", "");
			JSONObject desc = new JSONObject();
			desc.put("name", s.getName());
			desc.put("code", s.getCode());
			desc.put("symbol", "");
			desc.put("short_desc", "");
			desc.put("long_desc", s.getDescription());
			JSONArray arr = new JSONArray();
			arr.put(s.getImages());
			desc.put("images", arr);
			o.put("descriptor", desc);

			if (CollectionUtils.isNotEmpty(psus)) {
				PSU p = psus.get(0);
				JSONObject price = new JSONObject();
				if (null != p.getCurrency())
					price.put("currency", p.getCurrency().getIsocode());
				else
					price.put("currency", "");
				price.put("value", p.getPrice());
				price.put("estimated_value", "");
				price.put("computed_value", "");
				price.put("listed_value", "");
				price.put("offered_value", "");
				price.put("minimum_value", p.getDiscountPrice());
				price.put("maximum_value", "");
				o.put("price", price);
			}

			if (map.get(s.getStore().getCode()) != null) {
				map.get(s.getStore().getCode()).add(o);
			} else {
				map.put(s.getStore().getCode(), new ArrayList<>());
			}

		});

		map.forEach((k, v) -> {
			JSONObject o = new JSONObject();
			o.put("id", k);
			o.put("ttl", "PT24H");
			JSONObject desc = new JSONObject(template5);
			o.append("locations", "[]");
			o.put("rateable", "false");
			o.put("descriptor", desc);
			o.put("@ondc/org/fssai_license_no", "");
			o.put("items", v);
			obj.append("bpp/providers", o);
		});

		return obj;
	}

}
